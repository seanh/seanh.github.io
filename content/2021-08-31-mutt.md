Title: Mutt
Status: draft

My guide to the [Mutt e-mail client][mutt.org]

<div class="toc"></div>

Getting Started
---------------

When you run `mutt` it'll try to guess the location of your local "spool
mailbox" (inbox), which probably doesn't exist on a modern PC or laptop. For me
it tries to open `/var/mail/seanh` which doesn't exist.

You can tell Mutt to open a connection to an IMAP e-mail provider like Fastmail
or Gmail instead but you'll need to create an app password first...

### Creating an app password

If you're using Fastmail go to
[/settings/security/devicekeys/](https://www.fastmail.com/settings/security/devicekeys/)
in Fastmail's web interface, unlock the interface, and click
<samp>New App Password</samp>.

<figure markdown="1">
  ![Creating an app password in Fastmail.]({static}/images/fastmail-mutt-app-password.png "Creating an app password in Fastmail.")
  <figcaption markdown="1">
  Creating an app password in Fastmail.
  Mutt will need both IMAP and SMTP access.
  See [Fastmail's app passwords docs](https://www.fastmail.com/help/clients/apppassword.html) for details.
  </figcaption>
</figure>

For Gmail you go to [myaccount.google.com/security/](https://myaccount.google.com/security/) and click on <samp>App passwords</samp> to create one.

<figure markdown="1">
  ![Creating an app password in Gmail.]({static}/images/gmail-isync-app-password.png "Creating an app password in Gmail.")
  <figcaption markdown="1">
  Creating an app password in Gmail.
  See [Google's docs on app passwords](https://support.google.com/accounts/answer/185833).
  </figcaption>
</figure>

### Connecting to an IMAP account

Now to open your Fastmail inbox launch Mutt using `-f` to tell it to connect to
your Fastmail account. Enter the app password that you created above when
prompted:

<figure markdown="1">
```console
$ mutt -f imaps://USERNAME@fastmail.com@imap.fastmail.com
```
<figcaption markdown="1">
Connecting to Fastmail via IMAP.
</figcaption>
</figure>

For Gmail you need to select **Enable IMAP** in your Gmail settings before it'll work,
see [Gmail's IMAP docs](https://support.google.com/mail/answer/7126229) for details.
Then run:

<figure markdown="1">
```console
$ mutt -f imaps://USERNAME@imap.gmail.com
```
<figcaption markdown="1">
Connecting to Gmail via IMAP.
</figcaption>
</figure>

### Creating a muttrc file

You'll want to create a Mutt config file (a "muttrc" file) so you have a place
to keep your Mutt settings and so you don't have to enter long command line
arguments every time you launch Mutt.

Mutt looks for your muttrc file in three locations and uses whichever it finds
first:

1. `~/.muttrc`
2. `~/.mutt/muttrc`
3. `~/.config/mutt/muttrc`

Here's a minimal muttrc file to open a Fastmail account:

```
# ~/.muttrc

set folder=imaps://USERNAME@fastmail.com@imap.fastmail.com
set spoolfile=+Inbox
```

Now you can just run `mutt` without any command line arguments and it'll ask
you for your Fastmail app password and open your inbox:

```console
$ mutt
```

### Saving your app password locally

You can save your app password in an encrypted password store so that
you don't have to type it in every time you launch Mutt.

We're going to use [pass](https://www.passwordstore.org/) to store the app password:

1. Install `pass`. If you're on Ubuntu it's just:

   ```console
   $ sudo apt install pass
   ```

2. Create a GPG key that'll be used to encrypt the password store:

   ```console
   $ gpg --full-generate-key
   ```

3. Initialize the password store with the GPG key:

   ```console
   $ pass init <GPG_KEY_ID>
   ```

   If you're not sure what the GPG key's ID is you can run `gpg --list-secret-keys` to see.

4. You can now optionally run:

   ```console
   $ pass git init
   ```

   If you have [Git](https://git-scm.com/) installed and want `pass` to automatically keep history in a git repo.

5. Add the app password to the password store:

   ```console
   $ pass insert mutt
   ```

   Paste in the password when asked.

You should now be able to read the app password with:

```console
$ pass mutt
dfd...egf
```

Use the `imap_pass` setting to add the `pass` command to your muttrc:

<pre><code># ~/.muttrc

set folder=imaps://USERNAME@fastmail.com@imap.fastmail.com
<b>set imap_pass="`pass mutt`"</b>

set spoolfile=+Inbox</code></pre>

The backticks in ``set imap_pass="`pass mutt`"`` tell Mutt to run `pass mutt` to get the value for the `imap_pass` setting.
Now when you run `mutt` it'll open your Fastmail inbox without asking you for your password.

### Some sensible muttrc settings

Here's some sensible settings to consider adding to your muttrc file:

```
# ~/.muttrc

set folder=imaps://USERNAME@fastmail.com@imap.fastmail.com
set imap_pass="`pass mutt`"

set spoolfile=+Inbox
set mbox=+Archive
set record=+Sent
set trash=+Trash

set history = 9999
set save_history = 9999
set history_remove_dups

set header_cache = ~/.muttcache
set message_cachedir = ~/.muttcache

unset use_domain
set beep_new
set pager_stop
set tilde
```

Here's what they do:

[`folder`](https://mutt.org/doc/manual/#folder)

: The path to the folder that contains all your mailboxes.

  This is the folder that the `change-folder` command (<kbd>c</kbd>) will open by default in
  the file browser if you answer <kbd>?</kbd> to the prompt <samp>Open mailbox ('?' for list):</samp>

  An `=` or `+` at the start of a mailbox path expands to the value of `folder`.
  For example to quickly open your `foo` folder you can press <kbd>c</kbd>
  to summon the <samp>Open mailbox:</samp> prompt then
  enter `=foo`.
  The `=` or `+` shortcut works in lots of places:
  in your muttrc file, when moving a message to another folder, when specifying a folder to open on the command line, etc.
  It's used in the muttrc file above to specify the locations of the inbox (`+Inbox`), archive (`+Archive`) and sent (`+Sent`) folders.
  There are [mailbox shortcuts](https://mutt.org/doc/manual/#shortcuts) for
  your inbox, archive and sent folders as well, see below.

[`imap_pass`](https://mutt.org/doc/manual/#imap-pass)

: The password for connecting to your IMAP server.

  Avoid storing the password in plain text in your muttrc file by using
  backticks to specify an external command for Mutt to call to get the
  password.

[`spoolfile`](https://mutt.org/doc/manual/#spoolfile)

: "Spoolfile" (or sometimes "spool mailbox" or "mailspool") is the wonderful name that Mutt uses for your inbox.
  This is the folder that Mutt opens by default when it first starts up (if you don't open another folder with the
  `-f` command line argument).

  You can also use the `$MAIL` or `$MAILDIR` environment variable to set your inbox instead of setting `spoolfile` in your muttrc file.

  `!` is the mailbox shortcut for the inbox.
  For example if you're in another folder you can quickly go back to your inbox by
  pressing <kbd>c</kbd> to summon the <samp>Open mailbox:</samp> prompt then entering `!`
  (so <kbd><kbd>c</kbd> <kbd>!</kbd> <kbd>Enter</kbd></kbd>).

[`mbox`](https://mutt.org/doc/manual/#mbox)

: "mbox" is Mutt's name for your archive folder: the folder that you move email from your inbox into after you've read it.
  This is called "All Mail" in Gmail (and in Fastmail if you have labels-mode enabled).

  `>` is the mailbox shortcut for your archive folder.
  For example to quickly move a message to your archive folder
  press <kbd>s</kbd> to summon the <samp>Save to mailbox:</samp> prompt then enter `>`:
  <kbd><kbd>s</kbd> <kbd>&gt;</kbd> <kbd>Enter</kbd></kbd>.

  If [`move`](https://mutt.org/doc/manual/#move) is set Mutt will automatically move read messages from your
  spoolfile to your mbox (`move` is off by default).

[`record`](https://mutt.org/doc/manual/#record)

: "Record file" is Mutt's name for your sent folder.
  `<` is the mailbox shortcut for the sent folder.

[`trash`](https://mutt.org/doc/manual/#trash)

: Your trash folder, Mutt moves deleted messages here.

[`history`](https://mutt.org/doc/manual/#history), [`save_history`](https://mutt.org/doc/manual/#save-history) and [`history_remove_dups`](https://mutt.org/doc/manual/#history-remove-dups)

: These control the histories that Mutt keeps of commands entered,
  search queries, etc (which you can recall with <kbd>&uarr;</kbd> at
  prompts on Mutt's command line). We set the history lengths to as long as
  possible, make the histories persist across Mutt restarts by saving them to a
  file, and remove duplicates from the histories.

[`header_cache`](https://mutt.org/doc/manual/#header-cache) and [`message_cachedir`](https://mutt.org/doc/manual/#message-cachedir)

: These settings cause Mutt to cache message headers and bodies in local
  databases. This greatly speeds up opening and searching large folders even
  when using local mailboxes.

  The [Header Caching](https://mutt.org/doc/manual/#header-caching) section in
  Mutt's manual says that if `header_cache` is a file Mutt will use one database
  for all folders which can be slower whereas if it's a directory it'll use one
  database file per folder. But Mutt seems to create `header_cache` as a *file*
  by default. So consider creating the `header_cache` directory yourself
  manually before launching Mutt:

  ```console
  $ rm -r ~/.muttcache  # Delete any existing cache file.
  $ mkdir ~/.muttcache  # Create an empty cache directory for Mutt to fill.
  ```

[`unset use_domain`](https://mutt.org/doc/manual/#use-domain)

: This prevents Mutt from automatically appending `@$hostname` (your local
  machine's hostname) to the end of email addresses that have no `@hostname`
  part. On a modern PC or laptop you almost certainly don't want Mutt to do
  this.

[`beep_new`](https://mutt.org/doc/manual/#beep-new)

: Makes Mutt "beep" for attention when it receives new mail.
  This may or may not produce an audible beep, it depends on your terminal emulator's settings.

  Mutt also [beeps when an error occurs](https://mutt.org/doc/manual/#beep) by default.

[`pager_stop`](https://mutt.org/doc/manual/#pager-stop)

: When reading an email this prevents scrolling down
  (with <kbd>Enter</kbd>, <kbd>Space</kbd> or <kbd>Page Down</kbd>) from moving to the next email
  in the folder when you reach the bottom of the current email.
  Instead it'll say <samp>Bottom of message is shown</samp> in the command line
  area if you've reached the bottom of the current message.
  You can still go to directly to the next message with <kbd>j</kbd> or <kbd>&darr;</kbd>.

  ("The pager" is Mutt's name for the screen that shows the contents of an email when you open one.)

[`tilde`](https://mutt.org/doc/manual/#tilde)

: Causes Mutt to draw `~`'s at the bottom of the pager to indicate when the message has ended, like Vim does.

Using Mutt
----------

### Overview

### The index

<div class="note" markdown="1">
**See also:**

* [The Message Index](https://mutt.org/doc/manual/#index-menu) in the Mutt manual
* The [list of all index menu functions](https://mutt.org/doc/manual/#index-map) in the Mutt manual
</div>

The index is normally the first screen you see when you open Mutt.
It shows the contents of the current folder (normally your inbox or "spoolfile"
when you first open Mutt, if no `-f` option was given on the command line).
It shows a (possibly empty) list of all the emails in the folder.

Some of the most useful keyboard commands in the index:

* <kbd>j</kbd> and <kbd>k</kbd> or <kbd>&darr;</kbd> and <kbd>&uarr;</kbd>
  move the selection down and up.
  These skip over deleted messages in the index,
  <kbd>J</kbd> and <kbd>K</kbd> move without skipping over deleted messages.

* <kbd>z</kbd> and <kbd>Z</kbd> or <kbd>Page Down</kbd> and <kbd>Page Up</kbd>
  move up and down a page at a time.

* <kbd>=</kbd> and <kbd>&#42;</kbd> or <kbd>Home</kbd> and <kbd>End</kbd> go to the top and bottom.

* <kbd>Tab</kbd> jumps to the next unread message.

* <kbd>Enter</kbd> or <kbd>Space</kbd> opens the selected message in the pager.

* <kbd>q</kbd> quits Mutt.

* <kbd>V</kbd> shows the Mutt version number and release date on the command line.

* <kbd>@</kbd> shows the full email address of the current message's sender on the command line.

* <kbd>C</kbd> prompts you for another mailbox to copy the current message to.

* <kbd>s</kbd> prompts you for another mailbox to "save" the current message to.

  "Save" is Mutt's word for "move": it adds the message to the other mailbox and marks it for deletion in the current mailbox.

* <kbd>o</kbd> choose a new sort order.

* <kbd>O</kbd> choose a reverse sort order.

* <kbd>$</kbd> saves changes to the mailbox. Quitting (<kbd>q</kbd>) will also prompt you to save any un-saved changes.

* <kbd>e</kbd> edits the current message in your editor.

  Bizarrely Mutt actually lets you open _received_ messages in your text editor and _edit_ them!
  When you save your changes and quit your editor it adds the new, edited copy
  of the message to the folder and marks the original for deletion.

#### Message status flags

Status flags are shown next to some messages in the index. Here's what some of the more common ones mean:

`D`
: The message is marked for deletion. See [Deleting Messages](http://localhost:4000/2021/08/31/mutt/#deleting-messages).

`d`
: The message has attachments that are marked for deletion.

`N`
: The message is new. <kbd>N</kbd> toggles the new flag on and off for the current message.

`O`
: The message is ["old"](#new-and-old-messages)

`r`
: You have replied to the message.

`!`
: The message is flagged as important. <kbd>F</kbd> toggles the important flag on and off.

`+`
: The message is to you only.

  Identifying "you" depends on the [`from`](https://mutt.org/doc/manual/#from) and [`alternates`](https://mutt.org/doc/manual/#alternates) settings.

`T`
: The message is to you and also to or CC'ing others.

`C`
: The message is CC'd to you.

`F`
: The message is from you.

The [full list of status flags](https://mutt.org/doc/manual/#tab-msg-status-flags) is in the Mutt manual.

<kbd>w</kbd> prompts you to choose a flag to set (deleted, new, [old](#new-and-old-messages), replied to, tagged or important) on the current message
and <kbd>W</kbd> prompts you to choose a flag to clear.

The [`index_format`](https://mutt.org/doc/manual/#index-format) setting controls how the messages are displayed in the index.
Here's an example of a message's line in the index with the default `index_format`:

    123 rD! Aug 28 Tom Cruise   (  21) Re: Shot in the Dark VIII

Here's what it means:

`123`
: The number of the message in the folder.

`rD!`
: The messages flags. In this case the message has been replied to (`r`),
  it's marked for deletion (`D`) and it's flagged as important (`!`).

`Aug 28`
: The date of the message.

`Tom Cruise`
: The name or address of the message's author.

`(  21)`
: An indicator of the size of the message including attachments.
  I think `21` means the message has 21 lines.
  This might say something like `8.7K` to give the size of the message in kilobytes or `5.7M`.

`Re: Shot in the Dark VIII`
: The message's subject line.

#### The Index's Status Line

The [`status_format`](https://mutt.org/doc/manual/#status-format) setting
controls the contents of the status line shown with the index menu. Different
status line items appear and disappear depending on the status. Here's the
default status line showing some of the more common items:

    -*-Mutt: =Inbox [Msgs:3 New:1 Old:1 Flag:1 74K]--(threads/date)--(all)-

And here's what they mean:

`Mutt: =Inbox`
: Tells you what folder you're in.

`Msgs: 3`
: Tells you how many messages are in the folder.

`New: 1`
: Tells you that the current folder contains 1 new message.

`Old: 1`
: Tells you that the current folder contains 1 ["old"](#new-and-old-messages) message.

`Del: 1`
: Tells you that the current folder contains 1 deleted message.

`Flag: 1`
: Tells you that the current folder contains 1 flagged message.

`74K`
: The size of the current folder.

`(threads/date)`
: The current sort order.

`(all)`
: The location in the current folder.
  `(all)` means the entire contents of the folder are in view.
  In larger folders it'll show something like `(52%)` indicating how far you are through the folder
  or `(end)` if the last message in the folder is in view.

### The Pager

<div class="note" markdown="1">
**See also:**

* [The Pager](https://mutt.org/doc/manual/#pager-menu) in the Mutt manual
* The [list of all pager menu functions](https://mutt.org/doc/manual/#pager-map) in the Mutt manual
</div>

Pressing <kbd>Enter</kbd> or <kbd>Space</kbd> in the index opens the current
message in the pager, which is the menu that shows the body of an opened
message. The pager is also used to show other things, for example <kbd>?</kbd>
opens the current menu's help in the pager.

Most of the index's keyboard commands also work in the pager, including many of
the movement commands and the commands for acting on the current message.

<kbd>Enter</kbd> and <kbd>Backspace</kbd> scroll down and up one line at a time.

<kbd>T</kbd> toggles the display of quoted text, and <kbd>S</kbd> scrolls past
quoted text.

#### The Pager's Status Line

The [`pager_format`](https://mutt.org/doc/manual/#pager-format) setting
controls the contents of the status line when in the pager. Here's what the default format looks like:

    -rK!- 2/10: Tom Cruise  Re: Example subject -- (93%)

And here's what it means:

`-rK!-`
: The message's status flags.
  In this case the message has been replied to (`r`),
  it contains a PGP public key (`K`),
  and it's flagged as important (`!`).

`2/10`
: The current messages number (`2`) and the total number of messages in the folder (`10`).

`Tom Cruise`
: The name or address of the message's author.

`Re: Example subject`
: The message's subject line.

`(93%)`
: How far the pager is through the message.
  Like in the index this will be `(end)` if the bottom of the message is in view
  or `(all)` if the entire message is in view.

#### Headers

<div class="note" markdown="1">
**See also:** [Message Header Display](https://mutt.org/doc/manual/#msg-hdr-display) in the Mutt manual.
</div>

You can control what email headers get shown in the pager and in what order
with the `ignore`, `unignore` and `hdr_order` settings. A good tactic is to do
`ignore *` to hide all headers then use `unignore` to show only specific
headers. Here are my current settings:

    # ~/.muttrc

    ignore *
    unignore  from to x-original-to delivered-to x-delivered-to reply-to subject date size user-agent x-mailer x-url list-id list-unsubscribe list-archive list-post list-subscribe list-help
    hdr_order from to x-original-to delivered-to x-delivered-to reply-to subject date size user-agent x-mailer x-url list-id list-unsubscribe list-archive list-post list-subscribe list-help

#### Opening URLs

When a message contains URLs Mutt can open them in a browser.
This requires installing [urlview](https://github.com/sigpipe/urlview) which is a separate program from the creator of Mutt.
On Ubuntu:

```console
$ sudo apt install urlview
```

Then add these lines to your muttrc:

    # ~/.muttrc

    macro index \cb |urlview\n
    macro pager \cb |urlview\n

<div class="note" markdown="1">
If you're on Debian or Ubuntu you don't need to add this to your
muttrc: it's already in `/etc/Muttrc`.
</div>

This'll bind <kbd><kbd>Ctrl</kbd> + <kbd>b</kbd></kbd> in the index or pager to
open the current message in urlview.  It'll show you a list of all the URLs
found in the message and you can use <kbd>Enter</kbd> to open one in a browser.


You can configure urlview, including what command it uses to open URLs, with a
`~/.urlview` file. See [`man urlview`](https://linux.die.net/man/1/urlview).
For example:

    # ~/.urlview

    COMMAND firefox -new-window %s

#### Attachments

<div class="note" markdown="1">
**See also:** [Mutt's MIME Support](https://mutt.org/doc/manual/#mimesupport)
in the Mutt manual.
</div>

##### Viewing Attachments

When viewing a message with attachments the attachments appear in the pager
like this:

    [-- Attachment #1 --]
    [-- Type: text/plain, Encoding: 7bit, Size: 0.5K --]

If Mutt knows how to decode the attachment to text then this will be followed
by a plain text representation of the attachment's contents. You might even
see multiple attachments rendered inline in the pager one after another:

    Date: Wed, 02 Mar 1970 14:43:23 -0500
    From: Sean Hammond <seanh@example.com>
    To: ...
    Subject: ...

    [-- Attachment #1 --]
    [-- Type: text/plain, Encoding: 7bit, Size: 0.5K --]

    This is the content of the first attachment.

    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque leo quam,
    ultrices ac quam mattis, dignissim dapibus lorem. Nam sed leo bibendum,
    condimentum lectus nec, pretium ex.

    [-- Attachment #2 --]
    [-- Type: text/plain, Encoding: 7bit, Size: 5.4K --]

    Nullam sodales, enim at euismod faucibus, lorem dolor varius est, et
    tincidunt arcu quam ut est. Donec in leo lacus.  Donec sed tellus sed
    ligula commodo vestibulum. Mauris sed sem magna.  Pellentesque et interdum
    sapien. Sed nulla sapien, lacinia ac lacinia nec, ornare vel ipsum. Aenean
    id quam eget ipsum ultricies ullamcorper. Interdum et malesuada fames ac
    ante ipsum primis in faucibus. Pellentesque ut mauris ut mi fringilla
    porttitor dignissim ut ex.

    ...

If Mutt isn't able to decode the attachment to text then it'll display a
message where the attachment's contents would go saying
`<MIME_TYPE> is unsupported (use 'v' to view this part)`, like this:

    [-- Attachment #3: 5_APPLICATION FORM.doc --]
    [-- Type: application/vnd.ms-word, Encoding: base64, Size: 68K --]

    [-- application/vnd.ms-word is unsupported (use 'v' to view this part) --]

You can't open attachments directly from the pager.
You have to do as Mutt says and press <kbd>v</kbd> (from either the index or the pager)
to go to the [attachment menu](https://mutt.org/doc/manual/#attach-menu) for
the current message.

The attachment menu shows a list of all the message's attachments and
lets you save, print, pipe, delete, and view attachments. Here's what the
attachment menu looks like for a plain text email (the first `text/plain`
attachment is the email's body) with an HTML file and a Microsoft Word document
attached:

    I     1 <no description>       [text/plain, 7bit, us-ascii, 0.5K]
    A     2 Resume.html            [text/html, 7bit, iso-8859-1, 5.4K]
    A     3 APPLICATION_FORM.doc   [applica/vnd.ms-wor, base64, 68K]

<kbd>Enter</kbd> in this menu opens the selected attachment in one of three ways:

1. If Mutt can render the attachment to plain text itself (without calling an
   external program) it'll do so and will open a pager showing just the
   contents of this one attachment (not the whole email).

   As well as plain text Mutt "knows" internally how to render HTML to plain
   text by just showing the HTML source code, so <kbd>Enter</kbd> on an HTML
   attachment just shows the source as text:

   <figure markdown="1">
   ![The source code of an HTML attachment in Mutt's pager.]({static}/images/mutt-html-raw.png "The source code of an HTML attachment in Mutt's pager.")
   <figcaption markdown="1">
   The source code of an HTML attachment in Mutt's pager.
   </figcaption>
   </figure>

2. If Mutt doesn't know internally how to render the attachment to plain text
   then it'll look in your mailcap files (see below) for an external program to
   open the attachment with.

   <kbd>m</kbd> instead of <kbd>Enter</kbd> forces Mutt to open the attachment
   with an external program even if it *could* render the attachment to plain
   text itself.
   You _have_ to use <kbd>m</kbd> to open plain text or HTML attachments with
   external programs: if you press <kbd>Enter</kbd> Mutt will render
   them to text itself.

3. Finally, if Mutt can't find a matching entry in your mailcap files then it'll render the attachment as raw text.

   <kbd>T</kbd> instead of <kbd>Enter</kbd> or <kbd>m</kbd> will force Mutt to
   open an attachment as raw text even if it could open it with an external
   program.

   Attachments rendered as raw text usually aren't very readable.
   For example for PDF attachments it displays the raw PDF source code.
   For image attachments it just shows the binary contents of the file as raw text.

   <figure markdown="1">
   ![The raw text of a PDF attachment in Mutt's pager.]({static}/images/mutt-raw-pdf.png "The raw text of a PDF attachment in Mutt's pager.")
   <figcaption markdown="1">
   The raw text of a PDF attachment in Mutt's pager.
   </figcaption>
   </figure>

   <figure markdown="1">
   ![The raw text of an image attachment in Mutt's pager.]({static}/images/mutt-raw-jpeg.png "The raw text of an image attachment in Mutt's pager.")
   <figcaption markdown="1">
   The raw text of an image attachment in Mutt's pager.
   </figcaption>
   </figure>

You can also save an attachment to file with <kbd>s</kbd> or print it with
<kbd>p</kbd>, among other actions.  See the [attachment menu key
bindings](https://mutt.org/doc/manual/#tab-attachment-bindings) in the Mutt
manual for the full list.

##### The mailcap file

The mailcap file tells Mutt which external commands to use to open which types of attachments.
The file maps MIME types to commands for opening files.
On Ubuntu Mutt uses the system mailcap file at `/etc/mailcap` by default.
Here's a simplified excerpt:

    # /etc/mailcap

    image/png; eog %s
    application/pdf; evince %s
    text/html; lynx -dump -force_html %s; copiousoutput

A `copiousoutput` label in a mailcap entry tells Mutt that the command converts
files to plain text that it prints to stdout, in which case Mutt shows the
command's output in a pager in the terminal. Otherwise, if the mailcap entry
_doesn't_ have a `copiousoutput` label, then the attachment will be opened in
the external program in a separate window.

Programs get added to `/etc/mailcap` automatically when you `apt` install them.
For example it contains entries for Firefox and Chrome (multiple entries for
opening different file types), and `apt install`'ing all kinds of other
programs adds entries for them too.

The problem with all this is that as you install programs (or as they come
pre-installed on your system, or get installed along with other things)
`/etc/mailcap` ends up with multiple entries for each MIME type. Mutt uses the
**first** matching entry for the attachment's type, which might not be the
program you want. For example on my system Mutt opens HTML attachments in
Chrome rather than Firefox, PDFs in The GIMP rather than Evince, and images in
ImageMagick instead of Eye Of Gnome.

You can extend or override the mailcap entries from `/etc/mailcap` with your
own `~/.mailcap` file. So you can look in `/etc/mailcap` for the entries
matching the programs you want Mutt to use and "promote" them by copy-pasting
them into `~/.mailcap`, forcing Mutt to use those programs. Here's an excerpt
from my `~/.mailcap` file:

<pre><code># ~/.mailcap
text/html; firefox -private-window %s; test=test -n "$DISPLAY"<b>; needsterminal</b>
image/*; eog %s; test=test -n "$DISPLAY"
application/pdf; evince %s; test=test -n "$DISPLAY"</code></pre>

These were all copy-pasted from `/etc/mailcap`.

The `test=test -n "$DISPLAY"`'s ensure that these commands are only used when connected to a graphical environment.

I added the `needsterminal` to the Firefox entry to make it work with Mutt, it
seems to be necessary to prevent <samp>File not found</samp> errors from
Firefox.

I also changed `eog`'s MIME type to `image/*` which matches any image type.
`/etc/mailcap` contains lots of separate entries for `eog` (`image/bmp`,
`image/png`, etc). The `/*` is unnecessary, this is equivalent:

<pre><code># ~/.mailcap
<b>image</b>; eog %s; test=test -n "$DISPLAY"</code></pre>

The locations where Mutt will look for mailcap files are defined by the
[`mailcap_path`](https://mutt.org/doc/manual/#mailcap-path) setting. You
can query its current value with `mutt -Q mailcap_path`:

```console
$ mutt -Q mailcap_path
mailcap_path="~/.mailcap:/usr/share/mutt/mailcap:/etc/mailcap:/etc/mailcap:/usr/etc/mailcap:/usr/local/etc/mailcap"
```

Or `:set ?mailcap_path` on Mutt's internal command line.
And of course you can change `mailcap_path` in your muttrc:

    # ~/.muttrc

    set mailcap_path="~/.mailcap:~/.mutt/mailcap:/usr/share/mutt/mailcap:..."

##### Rendering attachments inline

You can use the [`auto_view`](https://mutt.org/doc/manual/#auto-view) setting
to get Mutt to call external programs to render attachments to plain text and
show them inline in the pager when viewing an email, without having to go into
the attachments menu and open the attachment.

For example to enable auto viewing of HTML attachments add this to your muttrc:

    # ~/.muttrc

    auto_view text/html

If you want to auto-view multiple types separate them with spaces:

    # ~/.muttrc

    auto_view text/html application/pdf ...

There has to be a `copiousoutput` entry for the MIME type in your mailcap files
for it to work: only `copiousoutput` entries can be used for inline
rendering.
For example installing Lynx (`sudo apt install lynx`) will add this to
`/etc/mailcap`:

<pre><code># /etc/mailcap

text/html; /usr/bin/lynx -dump -force_html %s; <b>copiousoutput</b>; description=HTML Text; nametemplate=%s.html</code></pre>

Now when you open HTML emails in Mutt it'll use Lynx to render the HTML
attachments inline.

`auto_view` will also cause <kbd>Enter</kbd> in the attachment menu to open
HTML attachments using a `copiousoutput` mailcap entry, so you no longer have
to press <kbd>m</kbd> to open HTML attachments.
This only works with `copiousoutput` entries.
Press <kbd>T</kbd> if you still want to see the raw HTML text.

If you set [`implicit_autoview`](https://mutt.org/doc/manual/#implicit-autoview)
then Mutt will automatically use any `copiousoutput` mailcap entries that it
finds to render attachments inline, so you don't have to add them all to `auto_view`:

    # ~/.muttrc

    set implicit_autoview

Some emails use the `multipart/alternative` MIME type to send the same content
in two different formats as two separate attachments. For example it's common
for emails to be sent with both plain text and HTML versions.
For `multipart/alternative` emails Mutt doesn't render all the alternative
attachments inline, it chooses just one alternative to render (but the attachments
menu _does_ show all the alternative attachments).
You can use the
[`alternative_order`](https://mutt.org/doc/manual/#alternative-order) setting
to tell Mutt which format to prefer for inline rendering when multiple are
present.

For example if you have inline rendering of HTML attachments configured as above
you can add this to your muttrc to tell Mutt to nonetheless display the plain
text version if the email came with one:

    # ~/.muttrc

    alternative_order text/plain

You can teach Mutt both how to render a MIME type to text _and_ how to open it
in an external program by adding two mailcap entries to your `~/.mailcap` file:
one with `copiousoutput` and one without. The `copiousoutput` entry must always
come second in the mailcap file:

    # ~/.mailcap

    text/html; firefox %s; needsterminal
    text/html; /usr/bin/lynx -dump -force_html %s; copiousoutput

When Mutt wants to render an HTML attachment inline (if you have `auto_view
text/html` or `set implicit_autoview` in your muttrc) it only considers `copiousoutput` entries from the
mailcap file so it'll use Lynx even though the Firefox entry comes first.

But when you press <kbd>m</kbd> in the attachment menu Mutt just looks for the
first matching mailcap entry, `copiousoutput` or not, so it'll open the file in
Firefox.

##### The mime.types file

The mailcap file maps MIME types to commands, but how does Mutt know what an attachment's MIME type is?

The `mime.types` file maps filename extensions to MIME types. Here's an excerpt:

    # ~/.mime.types

    application/postscript          ps eps
    application/pgp                 pgp
    audio/x-aiff                    aif aifc aiff

Mutt looks for the `mime.types` file at `/usr/local/share/mutt/mime.types` or
`/etc/mime.types`, and you can extend and override it with a `~/.mime.types`
file. The `/etc/mime.types` file on Ubuntu looks pretty comprehensive so you're
unlikely to need to extend or customize it.

#### Deleting Attachments

TODO.

The `d` flag.

`~X>0` to find attachments to delete.

### Mutt's built-in help

Each screen in Mutt has a help line at the top showing you the most common keyboard commands for that screen.
You can hide/show the help line by summoning Mutt's command line with <kbd>:</kbd> and entering `:toggle help`
(or add `set nohelp` to your muttrc).

Press <kbd>?</kbd> on any screen to enter the full help for that screen.
This shows you a list of all the commands for that screen and you can navigate the help page with the usual controls:
<kbd>&darr;</kbd>,
<kbd>&uarr;</kbd>,
<kbd>Page Down</kbd>,
<kbd>Page Up</kbd>,
<kbd>/</kbd> to search.
<kbd>?</kbd> even opens the help for the help screen.
<kbd>i</kbd> exits the help screen.

The help screen also shows "unbound functions" that are available on the current screen but not bound to a key.
You can execute an unbound function by entering `:exec function-name` at Mutt's command line.

### Changing folders

<kbd>c</kbd> in the index or pager summons the <samp>Open mailbox ('?' for list):</samp>
prompt on Mutt's command line. If you enter <kbd>?</kbd> it opens the folder from your
[`folder`](https://mutt.org/doc/manual/#folder) setting in Mutt's file browser
so you can browse to a mailbox, see [The file browser](#the-file-browser).
Or you can type in the path to a folder at the prompt instead.

Some things you can do at this prompt:

* You can use [mailbox shortcuts](https://mutt.org/doc/manual/#shortcuts):

  `!` at the prompt opens your inbox (the [`spoolfile`](https://mutt.org/doc/manual/#spoolfile) setting),
  `>` opens your archive folder (the [`mbox`](https://mutt.org/doc/manual/#mbox) setting),
  and `<` opens your sent folder (the [`record`](https://mutt.org/doc/manual/#record) setting).

  These can also be used to open subfolders. For example if you have subfolders
  inside your archive folder can open one with `>/foo`.

  `=` or `+` expands to the value of your
  [`folder`](https://mutt.org/doc/manual/#spoolfile) setting, so you can open
  your `/Drafts` folder with `=Drafts` (no `/` needed).

  `-` takes you back to the mailbox you were previously in.

* You can use tab-complete.

  For example: <kbd><kbd>=Dr</kbd> <kbd>Tab</kbd></kbd> will autocomplete to `=Drafts`.

  If there are multiple matches then <kbd>Tab</kbd> will complete as far as it can.
  For example if you have folders `lists/mutt-announce`, `lists/mutt-dev` and `lists/mutt-users`
  then <kbd><kbd>=lists/m</kbd> <kbd>Tab</kbd></kbd> will autocomplete to `lists/mutt-` but no further.
  If you now press <kbd>Tab</kbd> again then nothing will happen because it's waiting for you to provide more input to disambiguate.
  But if you ask it again by pressing <kbd>Tab</kbd> a _third_ time then it'll open a list of all matching folders in the browser.

### The file browser

If you press <kbd>?</kbd> at the <samp>Open mailbox ('?' for list):</samp>
prompt Mutt opens the folder from your
[`folder`](https://mutt.org/doc/manual/#folder) setting in its built-in file
browser so that you can browse to select mailbox to open.

Some things you can do in the file browser:

* <kbd>Tab</kbd> toggles back and forth between the directory view and the
  _mailboxes_ view, which is a shortlist of all the mailboxes that Mutt is monitoring for new mail.
  See [Monitoring for new mail](#monitoring-for-new-mail).

* If a folder contains subfolders then <kbd>Enter</kbd> will descend into the
  folder so you can see the subfolders. <kbd>Space</kbd> will open the parent
  folder as a mailbox rather than descending into it, useful if the parent
  folder itself contains mail.

### Deleting Messages

<kbd>d</kbd> in the index or pager "deletes" the current message.
Mutt's idea of deleting a message just means marking it for deletion not
actually deleting it.
Messages aren't actually deleted ("purged") until you hit
<kbd>$</kbd> to save changes to the mailbox.
If you try to quit Mutt or change mailboxes while there are un-purged messages
still marked for deletion it'll ask you whether you want to purge them. If you
say no the messages will no longer be marked for deletion the next time you
open the mailbox.

Un-purged messages marked for deletion have a `D` next to them in the pager.
You can highlight them (for example in bold red) with a line like this in your
muttrc file:

    # ~/.muttrc

    color index bold red default del

The <kbd>j</kbd>, <kbd>k</kbd>, <kbd>&darr;</kbd> and <kbd>&uarr;</kbd>
movement keys will jump over deleted messages.
Use <kbd>J</kbd> (<kbd><kbd>Shift</kbd> + <kbd>j</kbd></kbd>) and <kbd>K</kbd>
to move without skipping over deleted messages.

<kbd>u</kbd> undeletes the current message.

<kbd>D</kbd> prompts you for a pattern and marks all messages matching that pattern for deletion.

<kbd>U</kbd> prompts you for a pattern and undeletes all messages matching that pattern.
For example entering `all` at the <samp>Undelete messages matching:</samp>
prompt will undelete all deleted messages in the current folder.

If you have the `trash` setting set (for example `set trash=+Trash` in your
muttrc) then even when you purge deleted messages they still aren't really
gone: they get moved to the `trash` folder (the folder specified by the `trash` setting's value). Purging messages from the `trash`
folder really deletes them.

To restore a message from the trash folder you use the "save message" function
(<kbd>s</kbd>) and specify which folder to move it to. The message will be
added to the folder that you specify and marked for deletion in the trash
folder.

### Writing and sending mail

<div class="note" markdown="1">
**See also:** [Sending Mail](https://mutt.org/doc/manual/#sending) in the Mutt manual.
</div>

By default Mutt tries to use your local machine's `sendmail` program to send email
(`/usr/sbin/sendmail` by default, configurable by the [`sendmail`](https://mutt.org/doc/manual/#sendmail) setting).
On a modern PC or laptop you almost certainly don't have `sendmail` and don't want to install it.
Instead configure Mutt to use your mail provider's SMTP server by setting the `smtp_url` and `smtp_pass` settings.
For Fastmail add this to your muttrc:

    # ~/.muttrc

    set smtp_url=smtps://YOUR_USERNAME@fastmail.com@smtp.fastmail.com
    set smtp_pass="`pass mutt`"

For Gmail it would be:

    # ~/.muttrc

    set smtp_url=smtps://YOUR_USERNAME@smtp.gmail.com
    set smtp_pass="`pass mutt`"

``set smtp_pass="`pass mutt`"`` tells Mutt to run the external command `pass mutt` to get the SMTP password.
You must have installed `pass` and stored a Fastmail or Gmail app password in it,
see [Creating an app password](#creating-an-app-password)
and [Saving your app password locally](#saving-your-app-password-locally)
above.

You'll also want to tell Mutt your name and from-address:

    # ~/.muttrc

    set realname="YOUR NAME"
    set from="YOU@YOUR_DOMAIN.com"

With `smtp_url`, `smtp_pass`, `realname` and `from` in your muttrc you're now ready to send mail.
There are several ways to begin the process of sending a new message:

* To just start writing a new message press <kbd>m</kbd> in the index or pager.

* <kbd>r</kbd> starts a reply to the current message.

* <kbd>g</kbd> does a reply-all.

* For mailing list messages <kbd>L</kbd> sends a reply to the list,
  see [Mailing Lists](#mailing-lists).

* <kbd>f</kbd> prompts you for an address to forward the current message to.

  It opens the message in your editor before sending it to give you a chance to edit or add comments.

  The [`mime_forward`](https://mutt.org/doc/manual/#mime-forward) setting
  controls whether messages being forwarded are attached as separate
  `message/rfc822` MIME parts or inlined in the body of the message. By default
  they're inlined. This is what's called <samp>Forward</samp> versus
  <samp>Forward as attachment</samp> in other mail clients (Mutt's default is
  plain "Forward").

  Mutt can ask you whether you'd like to forward a message inline or as an attachment,
  showing this prompt on the command line:

      Forward as attachment? ([no]/yes):

  If you'd like it to ask this you each time you forward a message add this to
  your muttrc:

      # ~/.muttrc

      set mime_forward=ask-no

  There are also settings for what Mutt does with the message's attachments
  when forwarding a message that has attachments, and for which of the
  message's headers it forwards. See
  [Forwarding and Bouncing Mail](https://mutt.org/doc/manual/#forwarding-mail)
  in the Mutt manual.

* <kbd>b</kbd> prompts you for an address to **bounce** the current message to.
  Bouncing <q>sends a verbatim copy of a message to alternative addresses as if they were the message's original recipients</q>,
  see [Forwarding and Bouncing Mail](https://mutt.org/doc/manual/#forwarding-mail).

* <kbd><kbd>Esc</kbd> <kbd>e</kbd></kbd> starts a new message using the current message as a template (called "edit as new" in some mail apps).

* You can also use the `mutt` command to send email from the command line,
  including to send batch emails, see [Send e-mail from the command line](#send-e-mail-from-the-command-line).

Mutt opens your editor to write the body of the mail.
After you save the file and quit your editor you'll be taken to Mutt's _compose menu_ before sending the mail.
From the compose menu you can:

* Go back to editing the body of the message again (<kbd>e</kbd>).
* Edit the `To` address (<kbd>t</kbd>).
* Edit the `Subject` (<kbd>s</kbd>).
* Add a `Bcc` address (<kbd>b</kbd>).
* Add a `Cc` address (<kbd>c</kbd>).
* Attach a file (<kbd>a</kbd>).
* Attach another message (<kbd>A</kbd>) (it'll prompt you for a mailbox to open and select messages from).
* Encrypt and/or sign the message (<kbd>p</kbd>).
  See [Sending Cryptographically Signed/Encrypted Messages](https://mutt.org/doc/manual/#sending-crypto).
* And finally send the message (<kbd>y</kbd>) or abort sending the message (<kbd>q</kbd>).

See [Compose Menu](https://mutt.org/doc/manual/#compose-map) in the reference section of the Mutt manual for the full list of key bindings.

#### Sending Attachments

TODO

### Drafts

<div class="note" markdown="1">
[Postponing Mail](https://mutt.org/doc/manual/#postponing-mail) in the Mutt manual.
</div>

"Postponed" messages is Mutt's name for draft messages.
Before you can use drafts you have to set the
[`postponed`](https://mutt.org/doc/manual/#postponed) setting in your muttrc to
tell Mutt which folder to keep your drafts in:

    # ~/.muttrc

    set postponed=+Drafts

If you hit <kbd>P</kbd> in the compose menu Mutt will save the message to the
drafts folder instead of sending it.
<kbd>q</kbd> in the compose menu will also ask you if you want to postpone the message rather than discard it.

The index's status line will show <samp>Post: 1</samp> of you have postponed messages.

<kbd>R</kbd> in the index or pager resumes writing a previously saved draft.
Also if you hit <kbd>m</kbd> (to begin composing a new message)
it'll ask you if you want to resume a draft if you have one.

`mutt -p` on the command line launches Mutt and resumes any postponed message right away.

In each case if you have multiple messages in your drafts folder it'll show a
list of them to let you choose which to resume. You can delete and undelete drafts from this menu
with <kbd>d</kbd> and <kbd>u</kbd>.

### Selecting multiple messages to act on ("tagging")

<div class="note" markdown="1">
**See also:** [Using Tags](https://mutt.org/doc/manual/#tags) in the Mutt manual.
</div>

"Tagging" is Mutt's name for selecting multiple messages to act on them all at
once (for example to delete several messages at once).

<kbd>t</kbd> in either the index or pager tags or un-tags the current message.
Tagged messages have a <samp>&#42;</samp> flag next to them in the index,
and  `Tag: 1` appears in the status line to indicate that you have tagged messages.
You can also highlight tagged messages by adding this to your muttrc:

    # ~/.muttrc

    color index brightblue default tag  # Highlight tagged messages.

<kbd>;</kbd> then applies an action to all tagged messages. For example
<kbd><kbd>;</kbd> <kbd>d</kbd></kbd> deletes all tagged messages,
or <kbd><kbd>;</kbd> <kbd>s</kbd></kbd> moves all tagged messages to another folder.

You can reply to multiple messages at once (sending a single message that is in
reply to multiple messages, and gets sent to the senders of all of those
messages) by tagging messages then doing <kbd><kbd>;</kbd> <kbd>d</kbd></kbd>.

Similarly you can forward multiple messages as one with <kbd><kbd>;</kbd> <kbd>f</kbd></kbd>.

<kbd><kbd>Shift</kbd> + <kbd>t</kbd></kbd> will ask you for a pattern and tag
all messages matching that pattern. See search patterns above.
<kbd><kbd>Ctrl</kbd> + <kbd>t</kbd></kbd> un-tags messages matching
a pattern.

Tagged messages aren't remembered if you exit Mutt or change to another folder.

### Threads

<div class="note" markdown="1">
**See also:** [Threaded Mode](https://mutt.org/doc/manual/#threads) in the Mutt manual.
</div>

Mutt can display threaded email conversations as trees, like this:

    392 O L Sep 03 To python-ideas ( 12K) [Python-ideas] Add a special TypeError subclass for implementation errors
    393 O L Sep 03 To python-ideas ( 11K) ├─>[Python-ideas] Re: Add a special TypeError subclass for implementation error
    394 O L Sep 03 To python-ideas ( 16K) └─>[Python-ideas] Re: Add a special TypeError subclass for implementation error
    395 O L Sep 03 Cc python-ideas ( 22K)   └─>
    396 O L Sep 03 Cc python-ideas ( 27K)     └─>
    397 N L Sep 03 Cc python-ideas ( 28K)       └─>
    398 O L Sep 03 To python-ideas ( 11K) [Python-ideas] define an idiomatic way to make a generator that throws StopIter
    399 O L Sep 03 To python-ideas ( 12K) └─>[Python-ideas] Re: define an idiomatic way to make a generator that throws S
    400 O L Sep 03 To python-ideas ( 15K)   └─>

To enable it you have to set the [`sort`](https://mutt.org/doc/manual/#sort) setting to `threads`:

    # ~/.muttrc

    set sort=threads

(Debian's `/etc/Muttrc` does this for you.)

The threading algorithm uses the `In-Reply-To` and `References` headers that emails are supposed to have,
and also falls back on grouping together
messages with the same subject. A `*` next to a thread indicates that it's a
pseudo-thread that's been grouped by subject rather than by `In-Reply-To` or
`References`. Pseudo-threads can be turned off by setting [`strict_threads`](https://mutt.org/doc/manual/#strict-threads):

    # ~/.muttrc

    set strict_threads

The index and pager have some special features for working with threads:

* <kbd><kbd>Esc</kbd> <kbd>v</kbd></kbd> collapses the current message's thread onto one line.
  Or expands it again if the thread is already collapsed.
* <kbd><kbd>Esc</kbd> <kbd>V</kbd></kbd> collapses or expands _all_ threads in the current folder.

* The `n` and `o` status flags are shown for collapsed threads that contain new or ["old"](#new-and-old-messages) mail.

* <kbd>P</kbd> jumps to the current message's parent message in the thread
  (the message that the current message was in reply to).

* <kbd><kbd>Ctrl</kbd> <kbd>n</kbd></kbd> and <kbd><kbd>Ctrl</kbd> <kbd>p</kbd></kbd>
  jump to the first mail in the next or previous thread.
* <kbd><kbd>Esc</kbd> <kbd>n</kbd></kbd> and <kbd><kbd>Esc</kbd> <kbd>p</kbd></kbd> go to the next and previous subthread.

* <kbd><kbd>Ctrl</kbd> <kbd>r</kbd></kbd> marks the entire thread as read.
* <kbd><kbd>Esc</kbd> <kbd>r</kbd></kbd> marks the subthread as read.

* <kbd><kbd>Ctrl</kbd> <kbd>d</kbd></kbd> and <kbd><kbd>Ctrl</kbd>
  <kbd>u</kbd></kbd> delete and undelete all messages in the current thread.
* <kbd><kbd>Esc</kbd> <kbd>d</kbd></kbd> and <kbd><kbd>Esc</kbd> <kbd>u</kbd></kbd> delete and undelete the subthread.

* <kbd><kbd>Esc</kbd> <kbd>t</kbd></kbd> tags or untags an entire thread.

By default nothing indicates the presence of a collapsed thread in the index
except for the gap in the index numbers down the left hand side. You can
highlight collapsed threads with an underline by adding this to your muttrc:

    # ~/.muttrc

    color index underline default default "~v"  # Underline collapsed threads.

The manual gives the example of adding `%M` into
[`index_format`](https://mutt.org/doc/manual/#index-format) to display the
number of messages in a collapsed thread.
For example here's an `index_format` setting that's the same as the default
but adds `→(3)` before the subject of a collapsed thread (if the thread
contains `3` messages):

    # ~/.muttrc

    set index_format="%4C %Z %{%b %d} %-15.15L (%?l?%4l&%4c?)%?M? →(%M)? %s"

Here's what a collapsed thread with three messages looks like with the above `index_format`:

<pre><code>103 o L Aug 16 To python-ideas ( 14K) <b>→(3)</b> [Python-ideas] Re: Request for help</code></pre>

By default all threads are expanded whenever you open a folder.
If you want them to be collapsed instead add this to your muttrc:

    # ~/.muttrc

    folder-hook . 'push <collapse-all>'

### Monitoring for new mail

<div class="note" markdown="1">
**See also:** [Monitoring Incoming Mail](https://mutt.org/doc/manual/#mailboxes)
and [New Mail Detection](https://mutt.org/doc/manual/#new-mail) in the Mutt manual.
</div>

Mutt's status line displays <samp>New: n</samp> if there are any new mails in the current folder.
It'll also show a <samp>New mail in this folder</samp> notification on the
command line if any new mail arrives in the current folder.

New mails have an `N` flag next to them in the index.
You can use the `color` command in your muttrc file to highlight new messages,
for example in bold:

    # ~/.muttrc

    color index bold default default new

The `mailboxes` setting is a list of folders for Mutt to monitor in the
background for new mail. For example:

    # ~/.muttrc

    mailboxes !                  # Monitor my inbox for new mail.
    mailboxes +lists/mutt-users  # Also monitor my "lists/mutt-users" folder.
    mailboxes +lists/mutt-dev    # Also monitor "lists/mutt-dev".

Once you have some `mailboxes` configured lots of things happen:

* Mutt displays notification messages on the command line when any of the
  mailboxes receive new messages, even if you're not currently in that mailbox.
  The notifications look something like this:

      New mail in =lists/mutt-users

* Mutt's status line shows the number of mailboxes with new mail (not including
  the current folder) as <samp>Inc: n</samp>
  ("Inc" is short for "Incoming").

* Pressing <kbd>.</kbd> in the index or pager shows the "buffy list" which is a
  list of mailboxes that have new mail in them on Mutt's command line.

* The <samp>Open mailbox:</samp> prompt (<kbd>c</kbd>) automatically pre-fills
  with the first mailbox that has new mail. Pressing <kbd>Space</kbd> at this prompt
  cycles the pre-fill through all mailboxes with new mail.

* <kbd>y</kbd> in the index or pager opens the mailboxes view in the file
  browser. The mailboxes view lists all your mailboxes, shows which have new
  mail, and lets you choose one to open.

  Whenever you're in Mutt's file browser for any reason <kbd>Tab</kbd> toggles
  between the directory and mailboxes views.

  `mutt -y` opens Mutt directly in the mailboxes view instead of your inbox.

  Debian's `/etc/Muttrc` file adds a <kbd>y</kbd> keybinding to exit the browser:

      # /etc/Muttrc

      bind browser y exit

   This is really handy: you can hit <kbd>y</kbd> in the index or pager to go to the mailboxes
   view and then, if you don't want to change to any of the mailboxes, hit
   <kbd>y</kbd> again to go back to where you came from.

* Mutt's [sidebar](https://mutt.org/doc/manual/#intro-sidebar) (which is disabled
  by default) also shows a list of all your mailboxes and indicates which have
  new mail.

* You can check Mutt's mailboxes for new mail on the command line too, see [Check whether you have mail](#check-whether-you-have-mail).

You can add a folder to your `mailboxes` but ask Mutt not to notify about new
messages in this folder with `-nonotify`. The folder will still appear in the
mailboxes view and sidebar and they'll still indicate whether it has new mail
but Mutt's command line won't show notification messages every time a new mail
arrives:

    # ~/.muttrc

    mailboxes -nonotify +lists/mutt-users

### "New" and "Old" Messages

Every "unread" message in Mutt is either "new" or "old":

* When a message first appears in a mailbox it's considered "new".

  New messages have an `N` flag next to them in the index.
  Collapsed [threads](#threads) that contain new messages have a lower-case `n`
  flag (this is the same whether the new message is the first message in the
  thread that is still shown when the thread is collapsed, or whether the new
  message is one of the hidden collapsed messages).

  You can [search](#search) for new messages by searching for `new`, `=N` or
  `~N` (all three do the same thing).

  When there are new messages in the current mailbox `New:3` appears in the
  [status line](#the-indexs-status-line) (if there are 3 new messages).

* If you leave a mailbox that has new messages (by quitting Mutt or going to a
  different mailbox) then all the new messages become old:
  "old" messages are unread messages that you've seen before in the index but
  haven't opened in the pager yet.

  Old messages have an `O` flag next to them in the index.
  Collapsed threads that contain old messages have a lower-case `o` flag.

  You can search for old messages by searching for `old`, `=O` or `~O`.

  When there are old messages in the current mailbox `Old:3` appears in the
  status line (if there are 3 old messages).

Both new and old messages are considered "unread". They're the two types of
unread message: every unread message is either old or new. For example if you
search for `unread` (or `=U` or `~U`) it will find both old and new messages.
If you use a `%u` in [`status_format`](https://mutt.org/doc/manual/#status-format)
it'll count both new and old messages.

When you open a new or old message in the pager the new or old flag gets
removed and the message is now considered "read".
For example searches for `read` (or `=R` or `~R`) will now match the message.

"Read" messages are simply messages that have neither the "new" or "old" flag,
so you can mark a new message as read directly from the index (without
opening it) by removing the "new" or "old" flag from the message:

* <kbd><kbd>Ctrl</kbd> + <kbd>r</kbd></kbd>
  marks the entire current thread as read by removing any "new" or "old" flags
  from all messages in the thread.

  If the current message isn't part of a thread then <kbd><kbd>Ctrl</kbd> +
  <kbd>r</kbd></kbd> removes the flags from just the current message.

* <kbd>N</kbd> toggles the "new" flag on just the current message (not the
  whole flag).

  This turns a new message into a read message directly (it removes the
  "new" flag but doesn't add the "old" flag).

* To remove the "old" flag from just the current message press <kbd>W</kbd>
  (capital W) to summon the <samp>Clear flag?</samp> prompt then press
  <kbd>o</kbd>.

  To add the "old" flag to a message that lacks it you have press
  <kbd>w</kbd> (lower case) to summon the <samp>Set flag?</samp> prompt then
  press <kbd>o</kbd>.

A message can't be new and old at the same time. For example adding the "new"
flag to a message also removes the "old" flag.

**Mutt won't consider a mailbox to contain new mail if it only contains old
unread messages and no new unread messages**. The mailbox won't have an `N` flag
next to it in the mailboxes menu (there's no `O` flag for mailboxes), the mailbox won't
appear in the "buffy list" when you press <kbd>.</kbd>,
<kbd>Space</kbd> won't cycle though the mailbox at the <samp>Open mailbox:</samp>
prompt, etc.

If you don't like the distinction between "new" and "old" unread mail you can
tell Mutt not to change new messages into old ones when you leave a mailbox by
turning off the [`mark_old`](https://mutt.org/doc/manual/#mark-old) setting:

    # ~/.muttrc

    unset mark_old

Now the only way a message will get flagged as old is if it was already old or
if you manually set the old flag with <kbd>w</kbd>.

Even with `unset mark_old` the
[`mail_check_recent`](https://mutt.org/doc/manual/#mail-check-recent) setting
(on by default) means that a mailbox won't be considered as new _even if it
contains new messages_ if you have opened the mailbox since the new mail was
received. Mutt doesn't want to notify you about new messages that you've seen
before, even if you haven't opened them. By default a mailbox is only
considered as containing new messages if it contains "unseen" messages: new
messages _that you haven't seen before_ even in the index. You can turn this
off as well:

    # ~/.muttrc

    unset mail_check_recent

With both `unset mark_old` and `unset mail_check_recent` Mutt's behavior is
more like what you probably expect: new messages remain new until you open them
and a mailbox is flagged as new simply if it contains any new messages.

### Mutt's address book: aliases and groups

<div class="note" markdown="1">
**See also:** [Defining/Using Aliases](https://mutt.org/doc/manual/#alias)
and [Address Groups](https://mutt.org/doc/manual/#addrgroup)
in the Mutt manual.
</div>

Mutt's equivalent of an "address book" feature is the `alias` command.
To get started you need to set an [`alias_file`](https://mutt.org/doc/manual/#alias-file) in your muttrc and `source` it:

    # ~/.muttrc

    set alias_file=~/.muttaliases
    source $alias_file

To add someone to your address book press <kbd>a</kbd> in the index or pager.
This will create a new alias line from the current message and save it to the
`alias_file`, like this:

    # ~/.muttaliases

    alias bob Bob Smith <bob@example.com>

You can also just edit the `alias_file` directly.

Aliases can be used whenever an address would be used, e.g. in the `To: ` field
when composing a new message, or in search patterns. They can be tab-completed.

If you compose a new message and just hit <kbd>Tab</kbd> right away at the
<samp>To: </samp> prompt (without typing anything) you'll be taken to a list of
all your aliases to choose from.

You can query aliases on the command line too:

```console
$ mutt -A bob
bob@example.com
```

You can create aliases for multiple addresses if you want an easy way to message a group of people. For example:

    alias bob_and_fred Bob Smith <bob@example.com>, Fred Jones <fred@example.com>

Aliases can refer to other aliases:

    alias bob_smith Bob Smith <bob@example.com>
    alias bob bob_smith

Or to multiple other aliases:

    alias pals bob, fred, jim

Aliases can also be put into **groups** by using the `-group` option to the `alias` command
(see [Address Groups](https://mutt.org/doc/manual/#addrgroup) in the manual):

<pre><code>alias <b>-group favs</b> bob Bob Smith <bob@example.com></code></pre>

The `lists`, `subscribe` and `alternates` commands also support `-group`, and
there are also `group` and `ungroup` commands for adding address to and
removing addresses from groups directly.

You can't send a message to a group, they don't work on the <samp>To:</samp> prompt.
Use an alias with multiple addresses in it instead.
Groups are for using in search patterns when searching your mail, in hooks,
and in `color` commands.
For example you can use the `%f` search pattern modifier to search for messages
in the current mailbox from anyone in your `favs` group.
Press <kbd>l</kbd> on the index screen to summon the <samp>Limit to messages matching:</samp>
prompt and enter:

<pre><code>Limit to messages matching: <b>%f favs</b></code></pre>

The same `%f favs` search query can be used in a `color` command to highlight
messages from anyone in your `favs` group:

<pre><code>color index black brightyellow "<b>%f favs</b>"</code></pre>

The full set of group-related search pattern modifiers are:

`%f GROUP`
: Messages "originating from" any member of `GROUP`.

`%e GROUP`
: Messages "from" any member of `GROUP`.
  I'm not sure what exactly the difference is between "from" and "originating from".

`%c GROUP`
: Messages CC'd to any member of `GROUP`.

`%C GROUP`
: Messages to or CC'd to any member of `GROUP`.

`%L GROUP`
: Messages either originating from or received by any member of `GROUP`.

### Mailing Lists

<div class="note" markdown="1">
**See also:** [Handling Mailing Lists](https://mutt.org/doc/manual/#using-lists)
and [Mailing Lists](https://mutt.org/doc/manual/#lists) in the Mutt manual.
</div>

The [`auto_subscribe`](https://mutt.org/doc/manual/#auto-subscribe) setting
tells Mutt to automatically recognize emails from mailings lists (because they
contain `List-Post` headers) and add them to your `subscribe` list (the list of
mailing lists that you're subscribed to). You almost certainly want to add this to your muttrc:

    # ~/.muttrc

    set auto_subscribe

This means that:

1. Messages from mailing lists will be indicated with an `L` next to them in the index
2. The name of the mailing list will be shown in the index instead of each individual sender's name

<kbd>L</kbd> ([`list-reply`](https://mutt.org/doc/manual/#list-reply)) in the
index or pager sends a reply to the mailing list (rather than to the individual
sender).

In Mutt 2.1 (2021) or newer <kbd><kbd>Esc</kbd> <kbd>L</kbd></kbd> opens a
special list menu with options for subscribing to and unsubscribing from lists,
etc.

If Mutt fails to automatically recognize a mailing list you can add its address
manually using the `subscribe` command. The value is a regular expression so be
careful that it doesn't match more addresses than you intend.  For example:

    # ~/.muttrc

    subscribe ^mutt-users@mutt\\.org$

You can add particular mailing lists to the `unsubscribe` list to disable
auto-subscribing for those lists:

    # ~/.muttrc

    # Disable auto_subscribe for mutt-users@mutt.org and python-ideas@python.org.
    unsubscribe ^mutt-users@mutt\\.org$
    unsubscribe ^python-ideas@python\\.org$

### Search

#### Simple Searches

On Mutt's index screen pressing <kbd>l</kbd> summons the <samp>Limit to messages
matching:</samp> prompt. "Limiting" is Mutt's word for "filtering". Enter a
search pattern at this prompt and the list of messages will be filtered
to show only the ones that match your search.

The simplest kind of search pattern you can use is called a
[simple search](https://mutt.org/doc/manual/#simple-searches). There are
several <q>simple search keywords</q> that you can enter at the <samp>Limit to
messages matching:</samp> prompt:

`flag`
: Entering `flag` at the <samp>Limit to messages matching:</samp> prompt will
  filter the list to show only messages that are flagged as important.

`tag`
: Only tagged messages.

`new`
: Only new messages.

`old`
: Only ["old"](#new-and-old-messages) messages.

`read`
: Only read messages.

`unread`
: Only unread messages.

`repl`
: Only messages that have been replied to.

`del`
: Only messages that are marked for deletion.

`all`
: All messages. This is how you turn a limit off once you've applied one:
  hit <kbd>l</kbd> again then type <kbd>all <kbd>Enter</kbd></kbd>.

If you type anything else at the limit prompt, as long as it doesn't contain
`~`, `=` or `%`, then it'll do a "simple search": it will find all messages
that contain the given string in the `From` or `Subject` headers. For example
searching for `Bob` will find all messages from Bob or with Bob in the
subject. The behavior is configurable with the
[`simple_search`](https://mutt.org/doc/manual/#simple-search) setting.

Searches are **case-insensitive** if they don't contain any capital letters,
case-sensitive if they do.

When a limit filter is in effect the `Msgs` section in the status bar
changes to show how many messages match the filter and (after the `/`) the total
number of messages in the mailbox:

<pre><code>-&#42;-Mutt: ~/Mail/Fastmail/Archive/ [<b>Msgs:1336/66968</b> Old:1336 Flag:123 2870M]-</code></pre>

By default there's nothing on screen to show _what_ limit pattern is in effect but you can press
<kbd><kbd>Esc</kbd> <kbd>l</kbd></kbd> to temporarily show the current limit
pattern on the command line. You can add `%V` to
[`status_format`](https://mutt.org/doc/manual/#status-format) to show the active
limit pattern in the status line all the time.

The other way to search is with what Mutt calls "searching" (rather than
"limiting"): on the index screen press <kbd>/</kbd> to summon the
<samp>Search for:</samp> prompt. Instead of filtering the list to show only the matching messages Mutt will just jump
to the first matching message while still showing all messages in the list. <kbd>n</kbd> goes to the next match.
<kbd><kbd>Esc</kbd> <kbd>/</kbd></kbd> begins a search in the reverse
direction. The patterns that you can enter at the search prompt are the same as
the ones that you can use at the limit prompt.

#### Limiting and Threads

When you have a search limit applied and you have threading enabled some of the
messages in a thread could match your search filter while other messages in the
same thread don't. When this happens Mutt uses an `&` to indicate each "hidden message"
that is a thread ancestor of a matching message:

    82 O L Aug 15 Cc Python-Ideas ( 21K) &─>[Python-ideas] Re: Notation for subs
    86   L Aug 15 Cc Python-Ideas ( 19K) &─>[Python-ideas] Re: PEP idea
    125 O L Aug 19 Cc Python-Ideas ( 19K) &─&─&─>[Python-ideas] Re: Stack-scoped
    128 O L Aug 19 Cc Python-Ideas ( 24K)       └─&─>
    166 O L Aug 24 Cc Python-Ideas ( 20K) &─&─&─&─&─&─&─&─&─>[Python-ideas] Re: 
    170 O L Aug 24 Cc python-ideas ( 31K)                   └─&─&─&─>
    173 O L Aug 24 Cc python-ideas ( 19K)                     │   └─&─>
    175 O L Aug 24 Cc Python-Ideas ( 21K)                     └─>
    179 O L Aug 25 Cc python-ideas ( 19K)                       └─&─>
    216 O L Aug 23 Cc Python-Ideas ( 20K) &─>[Python-ideas] Re: NAN handling in s
    409   L Sep 03 Cc python-ideas ( 28K) ┬─&─>[Python-ideas] Re: Add a special T
    412   L Sep 03 Cc python-ideas ( 17K) └─&─>[Python-ideas] Re: Add a special T
    435   L Sep 06 Cc python-ideas ( 14K) &─&─&─>[Python-ideas] Re: Add @parametr
    442 N L Sep 09 Cc Python-Ideas ( 25K)   └─&─&─&─>[Python-ideas] Re: Different
    460   L Sep 07 Cc python-ideas ( 21K) &─&─>[Python-ideas] Re: open functions 

#### Searching in the Pager

<kbd>/</kbd> also works in the pager: it finds and highlights all the words in
the current message that match the query that you entered. <kbd>n</kbd> jumps to the next match.
<kbd>\</kbd> toggles the highlighting on and off.
[Regular expressions](#regular-expressions) also work in the pager.

This works whenever the pager is being used to show anything, not just the contents of messages.
For example <kbd>?</kbd> opens the help for the current screen in the pager and you can
use <kbd>/</kbd> to search the help.

#### Pattern Modifiers

For more specific searches you can use "pattern modifiers" that begin with `=`.
For example:

`=b diplodocus`
: Will search for all messages that have `diplodocus` in the body (either the
  body of the message itself or any of its attachments).

  For IMAP folders `=b` will use IMAP protocol server-side search.
  `~b` will force Mutt to do a client-side search instead but this
  can take a very long time because Mutt has to fetch every message in the
  folder.

`=B diplodocus`
: Searches for `diplodocus` in the whole message (body, headers and attachments).

  For IMAP folders `=B` will use IMAP protocol server-side search.
  `~B` will force Mutt to do a client-side search instead but this
  can take a very long time because Mutt has to fetch every message in the
  folder.

`=h diplodocus`
: Searches for `diplodocus` anywhere in any of the message's headers.

  For IMAP folders `=h` will use IMAP protocol server-side search.
  Server-side `=h` queries must have the special format `header_name: substring`
  and won't match partial header names. `=h header_name` will do a server-side search for
  all messages containing a given header regardless of the header's value.

  `~h` will force Mutt to do a client-side search instead but this
  can take a very long time because Mutt has to fetch every message in the
  folder.

`=s diplodocus`
: Searches for `diplodocus` in the subject line.

`=f catalina`
: Searches for messages "originating from" `catalina`.

`=l`
: Searches for messages addressed to known mailing lists.

`=p`
: Searches for messages to you.
  "You" is defined by the values of the [`from`](https://mutt.org/doc/manual/#from)
  and [`alternates`](https://mutt.org/doc/manual/#alternates) settings.

`=P`
: Searches for messages _from_ you.

`==`
: Searches for duplicate messages.

There are many more pattern modifiers. For the full list see the [table of all pattern modifiers](https://mutt.org/doc/manual/#tab-patterns)
in the Mutt manual.

There are also some pattern modifiers beginning with `%` instead of `=` that
are for searching for messages to and from addresses in address groups,
see [Mutt’s address book](#mutts-address-book-aliases-and-groups).

#### Regular Expressions

All of the pattern modifiers can be used with a `~` rather than an `=` to
search with a regular expression rather than a simple string.
Regular expressions are more powerful but slower.
Mutt uses "POSIX extended" regular expression syntax
(<q>more or less the syntax used by egrep and GNU awk</q>).
It's case-sensitive if the pattern contains upper case letters,
case-insensitive otherwise.
See [Regular Expressions](https://mutt.org/doc/manual/#regexp) in the manual for details.

#### Boolean Operators

<div class="note" markdown="1">
**See also:** [Nesting and Boolean Operators](https://mutt.org/doc/manual/#complex-patterns)
in the Mutt manual.
</div>

You can combine multiple `=` and `~`'s with boolean operators.

Multiple queries separated by spaces are combined using logical AND.
The manual gives this example which finds only messages with both `mutt` in recipients and `elkins` in the `From` header:

    ~t mutt ~f elkins

`|` is used for logical OR, for example this would search for `mutt` in the `To` or `Cc` field:

    ~t mutt|~c mutt

`!` is logical NOT and `()`'s can be used for grouping. Another example from the manual:

    !(~t mutt|~c mutt) ~f elkins

#### Searching by Date

<div class="note" markdown="1">
**See also:** [Searching by Date](https://mutt.org/doc/manual/#date-patterns)
in the Mutt manual.
</div>

You can use `=d` to search for messages sent on a particular date in `DD/MM/YY` or `YYYYMMDD` format.
For example to search for all messages in the current mailbox from 7th August 2021:

    Limit to messages matching: =d 7/8/2021

You can omit the month and year from the date and they default to the current month and year.
So `=d 7` will search for messages from the 7th of this month.

You can search for messages from a range of dates by separating two dates with a `-`:

    Limit to messages matching: =d 7/8/2021-8/8/2021

You can also used a single date with a `-` before or after it.
`7/8/2021-` will search for all messages from 7th August or later, whereas
`-7/8/2021` will search for all messages from 7th August or earlier.

Instead of using two dates you can give one date and "error margins" of time before and/or after that date.
`+` can be added to the end of a date to add an error margin after the date:
`+2d` would add an error margin of two days, `+1w` would be one week,
`+3m` three months, or `+1y` would be one year. For example to search for all messages
from 7th, 8th or 9th August of this year:

    Limit to messages matching: =d 7/8+2d

`-` instead of `+` adds error margin before rather than after a date. You can
use both at the same time:

    Limit to messages matching: =d 7/8+2d-3d

`*` adds the same error margin both before and after the date:

    Limit to messages matching: =d 7/8*3d

You can also use `>`, `<` and `=` to specify dates relative to the current date.
For example `=d <1m` will find messages less than one month. With relative
dates you can also use `H` for hours, `M` for minutes and `S` for seconds.

#### Searching Across Multiple Folders

Mutt can only search one folder at a time.
If you want to search across multiple folders at once there are several workarounds:

1. For Gmail accounts the `All Mail` folder contains all your mail so you can
   open this folder in Mutt and search it. Since it contains _all_ your mail
   the folder is likely to take a long time to open and to search, especially
   the first time.

2. If you [download your mail locally](#using-local-maildirs-instead-of-imap)
   then you have all your mail in a hierarchy of folders, one file per message,
   and you can search this folder with UNIX tools like grep or [ripgrep](https://github.com/seanh/ripgrep).

3. You can integrate Mutt with a mail search tool like mairix, mu, grepmail, notmuch, and others.
   See [SearchingMail](https://gitlab.com/muttmua/mutt/-/wikis/UseCases/SearchingMail) in the Mutt wiki
   or [Using Notmuch with bare Mutt, the old fashioned way](https://notmuchmail.org/notmuch-mutt/).

Personally if I want to search all my mail at once I'll just use the search in
the Fastmail or Gmail web interface, these are powerful and easy to use search
features that just work and that search across all mailboxes by default.

### Finding Large Messages to Delete

You can [search](#search) for large messages or attachments to delete in order to save space.

Searching for `=z MIN-MAX` finds messages with a disk size in the range `MIN-MAX`.
`<MAX`, `>MIN`, `MIN-` or `-MAX` can also be used.
`MIN` and `MAX` should be numbers ending in `K` (for kilobytes) or `M` (for megabytes).
For example `=z >1M` will find messages larger than 1MB.

`=X MIN-MAX` searches for messages with between `MIN` and `MAX` attachments.
Again `<MAX`, `>MIN`, `MIN-` or `-MAX` can also be used.
For example `=X >1` will find all messages with attachments.

You can then either mark some of the large messages for deletion with <kbd>d</kbd> in the
pager or index, or you can press <kbd>v</kbd> to open a message's [attachments menu](#viewing-attachments)
and then use <kbd>d</kbd> to mark *individual attachments* for deletion without
deleting the entire message.
Either way you have to then press <kbd>$</kbd> to actually delete the
messages/attachments.
If you have [`trash`](https://mutt.org/doc/manual/#trash)
set deleting messages will just move them to the trash folder, to save disk
space you'll then have to go and delete them from the trash.

Counting the number of attachments that a message has is a complicated business.
Which types of file should be counted as attachments?
When a message is sent in multiple formats (e.g. plain text and HTML) using the
`multipart/alternative` MIME type should the alternative formats count as
attachments or not?
Mutt's attachment counting behavior can be configured using the `attachments` and `unattachments`
commands and the `count_alternatives` setting,
see [Attachment Searching and Counting](https://mutt.org/doc/manual/#attachments) in the Mutt manual.
Debian's `/etc/Muttrc` file contains custom attachment counting settings.

### Mutt's built-in command line

Mutt has a command line at the bottom that's used both as a place to show
notifications, error messages and prompts and as a place for you to enter
commands and search queries.

If a notification is being shown then <kbd><kbd>Ctrl</kbd> + <kbd>l</kbd></kbd>
(which redraws the entire screen) will clear the notification.

On most screens (e.g. the index or pager) typing <kbd>:</kbd> will put you at
the command line. You can type muttrc commands like <kbd>:toggle help</kbd> to
show/hide the help line at the top (config settings changed on the command line
will only affect the current Mutt session, if you want settings to persist when
you restart Mutt you have to put them in your muttrc). Press <kbd>Enter</kbd>
to execute the command.

You can execute Mutt functions on the command line with `exec`.  For example to
compose a new message instead of using the key binding <kbd>m</kbd>
you could do <kbd>:exec mail</kbd>. This enables you to execute functions that
aren't bound to a key.
You can pass more than one function to `exec` (space-separated) to execute
multiple functions in a row.
Tab-complete works for function names.
The Mutt manual has a [list of all the functions](https://mutt.org/doc/manual/#functions).

If you press <kbd>!</kbd> Mutt will prompt your to enter an **external UNIX command** to run.
It'll execute the command and then show you its output before returning to Mutt.

You can create macros to bind keyboard shortcuts that type things at the command line and execute them (`\n`).
For example this binds <kbd>G</kbd> to run an external command (`mbsync -a`) using the <kbd>!</kbd> prompt:

    macro index,pager G "!mbsync -a\n"

This binds <kbd>R</kbd> to open the <kbd>:</kbd> prompt and pre-fill it with
`:set realname="`, allowing you to finish entering the command manually:

    macro index,pager R ':set realname="'

The command line is also used for various other prompts, such as when Mutt
prompts you for the <samp>To: </samp> address when writing a new message, and
many other things (entering search queries, answering yes/no prompts, changing
mailboxes, ...).

Whenever at the command line (for any prompt) you can always use <kbd>&uarr;</kbd>
to recall previous entries from the history.
<kbd><kbd>Ctrl</kbd> + <kbd>r</kbd></kbd> opens the history in a pager
so that you can select an item to enter.

See [Editor Menu](https://mutt.org/doc/manual/#editor-map) in the Mutt manual for all the keybindings.

### Marking messages to jump back to

<div class="note" markdown="1">
**See also:** [Marking Messages](https://mutt.org/doc/manual/#markmsg)
in the Mutt manual.
</div>

You can "mark" a message so that you can jump back to it later:

1. In the index mark the current message by typing <kbd>~</kbd> followed by an identifier key, for example:
   <kbd><kbd>~</kbd> <kbd>a</kbd></kbd>
2. Later jump back to that message by typing <kbd><kbd>'</kbd> <kbd>a</kbd></kbd>

You can mark as many messages as you want with different identifiers. It only
works from the index, not the pager. And it only works within a folder, you
can't jump back from a different folder. If you leave a folder and later come
back to it your marks within that folder will still be working. But marks
don't survive Mutt restarts.

Configuring Mutt
----------------

### Be aware of Debian's system config files

Debian's `mutt` package (which you'll get if you do `sudo apt install mutt` on
Ubuntu) installs a system muttrc file at `/etc/Muttrc` and that file also
sources further config files found in `/etc/Muttrc.d/`. These system config
files have all sorts of stuff in them, including:

* Limiting what headers are shown when displaying messages
* Binding <kvd>Delete</kbd> to delete the character under the cursor
  and <kbd><kbd>Esc</kbd> <kbd>Delete</kbd></kbd> or <kbd><kbd>Esc</kbd> <kbd>Backspace</kbd></kbd>
  to delete the word under the cursor.
* Enabling threads
* Binds <kbd><kdb>Esc</kbd> <kbd>b</kbd></kbd> to do a full body search (`~b`)
* Binds <kbd>F1</kbd> to open the local copy of the Mutt manual (`/usr/share/doc/mutt/manual.txt.gz`)
* Binds <kbd>y</kbd> to exit the file browser
* Lots of GPG settings
* A complete custom color scheme, overriding Mutt's default
* And much more

Mutt always reads these system config files before reading your personal config
file.  The only way to avoid them is to launch Mutt with `mutt -n` which skips
the system config file but still reads your personal one.

### Using local maildirs instead of IMAP

Using IMAP with Mutt has its downsides. Opening and searching large folders can
be slow (even with the `header_cache` and `message_cachedir` settings that
you'll see below). There are lots of brief pauses when you launch Mutt (while
it opens an IMAP connection) or when you open a folder or message (while it
downloads the messages). If your connection is unreliable Mutt's UI can hang
and disconnect.

Configuring Mutt to read local maildirs can be a nicer experience: it's faster
and more reliable because Mutt's working with local files. You have to use a separate
program like [isync](https://isync.sourceforge.io/) to download the email from
your IMAP account to a local maildir and to sync any changes back
up to your IMAP account. Then you configure Mutt to read the
local maildir with settings like these:

```
# ~/.muttrc

set folder=~/Mail      # If your mail is downloaded to ~/Mail.
set spoolfile=+Inbox   # If your inbox folder is at ~/Mail/Inbox.
set mbox=+Archive      # If your archive folder is ~/Mail/Archive.
set record=+Sent       # If your sent folder is ~/Mail/Sent.
set postponed=+Drafts  # If your drafts folder is ~/Mail/Drafts.
set trash=+Trash       # If your trash folder is ~/Mail/Trash.
```

You either run isync manually before and after using Mutt or you have it
running automatically in the background. You can even bind a key to run isync
(`mbsync`) from within Mutt:

```
# ~/.muttrc

macro index,pager G "!mbsync -a\n"
```

See [my post on backing up IMAP accounts with isync](/2021/08/22/backup-fastmail-and-gmail-with-isync/)
for how to set up isync and download your mail.

Even if your muttrc configures Mutt to connect by IMAP you can still open a
local mailbox with `mutt -f ~/Mail/Inbox`. Note that the `-f` points to a
particular mailbox, not just to the `~/Mail` directory. Or you can press
<kbd>c</kbd> in Mutt to summon the <samp>Open mailbox:</samp> prompt and enter
`~/Mail/Inbox`.
Mutt will still be connected to your IMAP account as configured in your muttrc.
Your [mailboxes](#monitoring-for-new-mail) will still be the IMAP ones from your muttrc,
and the mailbox shortcuts `!`, `>`, `<`, `=` and `+` will still refer to your IMAP locations.
But the currently open mailbox will be the local one.


### Setting, unsetting and querying variables

You change Mutt settings (variables) using the `set`, `unset` and `toggle` commands
either in your muttrc file or interactively on Mutt's command line
(summoned by pressing <kbd>:</kbd>) (variables changed on the command line only persist for the
current Mutt session).

Each variable is either a boolean, a number, a string or a quadoption.

**Booleans** can be set or unset. For example to turn the context-sensitive help
line at the top off and on again:

    unset help
    set help

`:toggle` also works for booleans (e.g. `toggle help`). `set invhelp` does the same as
`toggle help`. `set nohelp` is the same as `unset help`.

**Numbers** take a numeric value, for example:

    set history = 9999

**Strings** take a string value and can be enclosed in single or double quotes if
they contain spaces:

    set realname = "Sean Hammond"

Single quotes make literal strings, whereas variable substitutions (`$`), UNIX
command substitutions (backticks), etc are still applied within double quotes.

**Quadoptions** can either be yes, no, ask-yes or ask-no. For example the
`abort_noattach` option tells Mutt to abort sending an email if the body
contains the word "attach" but the email has no attachments. To tell Mutt to
*ask* you whether you want it to abort with the default answer being no:

    set abort_noattach = ask-no

To query the current value of a variable press <kbd>:</kbd> to summon Mutt's command line
and enter a `set` command prepending a `?` to the variable's name:

    :set ?help

The current value of the `help` setting will be printed on Mutt's command line.

You can also query variables on the UNIX command line with `mutt -Q help`
or print *all* settings and their values with `mutt -D`.

The `?` is only necessary with booleans and quadoptions. With strings
and numbers you can query the value by just:

    :set realname

You can create your own variables with names beginning with `my_`:

    set my_cfgdir = $HOME/mutt/config
    source $my_cfgdir/hooks
    source $my_cfgdir/macros

### Some muttrc tricks

#### Reloading your muttrc after changing it

Changes to your muttrc won't take effect until you restart Mutt.  To re-read
your muttrc and load new settings without quitting press <kbd>:</kbd> to summon
Mutt's command line then enter `source ~/.muttrc`.

You can also use `source` to compartmentalize your muttrc file into separate files.
For example you could put all your colour scheme settings in `~/.muttrc.colors`
and then put `source ~/.muttrc.colors` in your `~/.muttrc` file to load it.

Breaking up your config also allows you to do `source ~/.muttrc.colors` from
Mutt's command line to reload only the colour scheme part of your config.

#### Running external commands

In a muttrc file you can substitute the output of a UNIX command using
backticks:

    my_hdr X-Operating-System: `uname -a`

Double quotes prevent the output of backticks from being parsed:

    set imap_pass = "`gpg --batch -q --decrypt ~/.mutt/account.gpg`"

#### Substituting variables and environment variables

You can use `$` to substitute the value of a Mutt variable or environment variable:

    set record = +sent_on_$HOSTNAME

#### Source the output of a script

You can write a script that outputs muttrc lines to stdout and then use `|` to
execute the script and source its output. Debian's `/etc/Muttrc` file does
this:

    source /usr/lib/mutt/source-muttrc.d|

Command Line Mutt
-----------------

The `mutt` command has various options for doing things on the command line
besides launching Mutt. See [`man mutt`][man mutt] for
full documentation. Here are some of the more useful options:

### Expand an alias from your address book

Expand an alias (from your muttrc file or a file `source`'d by it) to its full
email address with `-A`:

```console
$ mutt -A bob
bob@example.com
```

### Query config settings

Get the value of a config setting (again, as set by your muttrc file) with `-Q`:

```console
$ mutt -Q record
record="=Sent"
```

Print *all* config settings and their values with `-D`:

```console
$ mutt -D
abort_noattach=ask-no
abort_noattach_regexp="attach"
abort_nosubject=ask-yes
...
```

### Send e-mail from the command line

Send an email from the command line. This could be used in scripts to send batch e-mails:

```console
$ mutt -s "<SUBJECT_LINE>" professor@bigschool.edu < message.txt
```

Aliases from your address book can be used in place of the email address on the command line.

If you don't want to save the body to a file you can use echo:

```console
$ echo "<BODY>" | mutt -s "<SUBJECT_LINE>" seanh@hypothes.is
```

Instead of piping it in with `<` or `|` you can specify a file to use as the body of
the message with `-i`. This will open `message.txt` in your editor in Mutt to
let you edit the body before sending:

```console
$ mutt -s "<SUBJECT_LINE>" professor@bigschool.edu -i message.txt
```

If you specify a body at all it'll open your editor for you to type in the body
from scratch:

```console
$ mutt -s "<SUBJECT_LINE>" professor@bigschool.edu
```

You can also miss out the `-s "<SUBJECT_LINE>"` or the e-mail address and it'll
prompt you for them:

```console
$ mutt professor@bigschool.edu
$ mutt -s "<SUBJECT_LINE>"
```

Command line options for sending messages:

`-s`
: Specify the subject line

`-a`
: Attach a file (e.g. `-a ~/Documents/foobar.doc`)

`-b`
: Add a BCC address

`-c`
: Add a CC address

### Alternative ways to launch Mutt

Launch Mutt opening a different mailbox (instead of the one given by the `spoolfile` setting) with `-f`:

```console
$ mutt -f ~/Mail/Fastmail/Archive
```

Mutt's mailbox shortcuts (`!`, `<`, `>` and `=`) also work here with the `-f` option. For example:

```console
$ mutt -f '<'      # Open your sent folder.
$ mutt -f '=Notes' # Open ~/Mail/Notes (if $folder is set to ~/Mail).
```

Launch Mutt opening the mailboxes list instead of the spoolfile with `-y`:

```console
$ mutt -y
```

Launch Mutt and resume a draft (postponed) message with `-p`:

```console
$ mutt -p
```

If you have more than one draft it'll open a menu to let you choose which one
to resume. If you have no drafts it'll exit without launching.

### Check whether you have mail

Launch Mutt only if the `spoolfile` (or the folder given by `-f`) contains
messages, otherwise exit:

```console
$ mutt -z
```

Launch Mutt opening the first mailbox (from your `mailboxes` list) with new
mail or exit immediately if none of the mailboxes have any new mail:

```console
$ mutt -Z
No mailbox with new mail.
```

[mutt.org]: https://mutt.org/ "The Mutt website."
[man mutt]: https://mutt.org/doc/mutt.1.txt "The Mutt man page."

TODO
----

Topics that I still want to add to this guide:

- Reading and sending encrypted mail
- Configuring multiple accounts with hooks
- Using and configuring Mutt's sidebar
- `set abort_noattach=ask-no` should be added to the section on attachments
  Makes Mutt warn you before sending an email with "attach" in the body but
  with no attachments. The string that it looks for in the body can be
  customized with `abort_noattach_regexp`.`
- [`reverse_name`](https://mutt.org/doc/manual/#reverse-name) should be 
  included in a section about `alternates`.
  Tells Mutt to use the address where you received the message as the `From`
  address (instead of the default from address in the `from` setting) when
  replying to a message, **if** that address is in your `alternates` list.
  Useful if you receive messages to multiple email addresses and want to reply
  from the address that each message was sent to.
  Mutt will show the recipient's name not the sender's in the index if it knows the message is from you
  (good when viewing your sent folder)
- [`reverse_alias`](https://mutt.org/doc/manual/#reverse-alias)
  should be added to the address book section.
  Tells Mutt's index view to show the personal names from your "aliases"
  (address book) in place of the `From` header names (or email addresses).
- Window titles with ts_enabled and ts_format_string
